<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portland Hacker Foundation - Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
</head>
<body>
<!-- Hero Header with Tree Image -->
<div class="hero-header">
    <h1>Portland Hacker Foundation</h1>
</div>

<!-- Sticky Navigation -->
<div class='contain-to-grid sticky'>
  <nav class='top-bar' data-options='sticky_on: large' data-topbar=''>
    <ul class='title-area'>
      <li class='name'>
        <h1>
          <a href='index.html'>
            <img alt="Portland Hacker Foundation" src="favicon.ico" width="32" height="32" />
            Portland Hacker Foundation
          </a>
        </h1>
      </li>
      <li class='toggle-topbar menu-icon'>
        <a href='#'>Menu</a>
      </li>
    </ul>
    <section class='top-bar-section'>
      <ul class="right">
        <li class="">
          <a href="index.html">Home</a>
        </li>
        <li class="active">
          <a href="chat.html">Chat</a>
        </li>
        <li class="">
          <a href="https://docs.google.com/forms/d/e/1FAIpQLSfaRK_Q_D808wyhj5cFVxF1wO9nUbItCgGJQuCJyHfUzVUVjw/viewform">Apply for a Grant</a>
        </li>
        <li class="">
          <a href="https://www.paypal.com/donate/?hosted_button_id=GP42Y6XNS8ZTA">Become a Sponsor</a>
        </li>
        <li class="">
          <a href="https://signal.group/#CjQKICe1IhiChi74GgLGJql1-YcUndkMvRtniTkAygWVlaSWEhAXFtsQRFJPPxtXyodsPbou">Join Signal Chat</a>
        </li>
      </ul>
    </section>
  </nav>
</div>

<div class="container" style="max-width: 800px; margin: 20px auto; padding: 20px;">
    <div class="chat-container">
        <div class="messages" id="messages" style="height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background-color: #f9f9f9;">
            <!-- Messages will be displayed here -->
        </div>
        <div class="input-container" style="display: flex; margin-bottom: 10px;">
            <textarea id="user-input" style="flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; resize: vertical; min-height: 80px;" placeholder="Type your message here..."></textarea>
        </div>
        <div class="button-container" style="display: flex; justify-content: space-between;">
            <button id="send-button" class="button" style="background-color: #1b5e20; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Send Message</button>
            <button id="reset-button" class="button secondary" style="background-color: #757575; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Reset Conversation</button>
        </div>
    </div>
</div>

<div id='footer'>
  <div class='three spacing'></div>
  <div class='row'>
    <div class='large-3 medium-3 columns'>
      <h1>
        <a href='index.html'>
          <img alt="Portland Hacker Foundation" src="favicon.ico" width="32" height="32" />
        </a>
      </h1>
      <p>Â©2025 Portland Hacker Foundation</p>
      <div class='spacing'></div>
      <div class='spacing'></div>
    </div>
    <div class='large-3 medium-3 columns'>
      <div class='spacing'></div>
      <div class='links'>
        <h4>Common Pages</h4>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="chat.html">Chat</a></li>
          <li><a href="https://docs.google.com/forms/d/e/1FAIpQLSfaRK_Q_D808wyhj5cFVxF1wO9nUbItCgGJQuCJyHfUzVUVjw/viewform">Apply for a Grant</a></li>
          <li><a href="https://www.paypal.com/donate/?hosted_button_id=GP42Y6XNS8ZTA">Become a Sponsor</a></li>
        </ul>
      </div>
      <div class='spacing'></div>
    </div>
    <div class='large-3 medium-3 columns'>
      <div class='spacing'></div>
      <div class='links'>
        <h4>Recommended Links</h4>
        <ul>
          <li><a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Hackerspace">Hackerspaces</a></li>
          <li><a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Hacker_ethic">Hacker Ethic</a></li>
          <li><a target="_blank" rel="noopener noreferrer" href="https://wiki.hackerspaces.org/Design_Patterns">Design Patterns</a></li>
        </ul>
      </div>
      <div class='spacing'></div>
    </div>
    <div class='large-3 medium-3 columns'>
      <div class='spacing'></div>
      <h4>Contact Information</h4>
      <ul>
        <li>Email: info@pdxhf.org</li>
        <li>Location: Portland, OR USA</li>
      </ul>
      <div class='spacing'></div>
      <ul class='socials'>
        <li>
          <a target="_blank" rel="noopener noreferrer" href='#'>
            <i class='fa fa-twitter'></i>
          </a>
        </li>
        <li>
          <a target="_blank" rel="noopener noreferrer" href='#'>
            <i class='fa fa-facebook'></i>
          </a>
        </li>
      </ul>
      <div class='spacing'></div>
    </div>
  </div>
  <div class='two spacing'></div>
</div>

<style>
    .thinking {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    .thinking-dots {
        display: flex;
    }
    .thinking-dot {
        height: 8px;
        width: 8px;
        margin: 0 4px;
        background-color: #999;
        border-radius: 50%;
        animation: thinking 1.5s infinite ease-in-out;
    }
    .thinking-dot:nth-child(1) {
        animation-delay: 0s;
    }
    .thinking-dot:nth-child(2) {
        animation-delay: 0.3s;
    }
    .thinking-dot:nth-child(3) {
        animation-delay: 0.6s;
    }
    @keyframes thinking {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-10px);
        }
    }
    .message {
        margin-bottom: 15px;
        padding: 10px;
        border-radius: 5px;
    }
    .user-message {
        background-color: #e3f2fd;
        text-align: right;
        margin-left: 20%;
    }
    .ai-message {
        background-color: #f1f1f1;
        margin-right: 20%;
    }
    .message-content {
        word-wrap: break-word;
    }
    .message-content pre {
        background-color: #f8f8f8;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
        position: relative;
    }
    .copy-button {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: #1b5e20;
        color: white;
        border: none;
        border-radius: 3px;
        padding: 3px 8px;
        font-size: 12px;
        cursor: pointer;
    }
    .copy-button:hover {
        background-color: #2e7d32;
    }
</style>

<script>
    $(document).foundation();
    
    // Add scroll event listener for header transition
    window.addEventListener('scroll', function() {
        const scrollPosition = window.scrollY;
        const body = document.body;
        
        // Add or remove 'scrolled' class based on scroll position
        if (scrollPosition > 50) {
            body.classList.add('scrolled');
        } else {
            body.classList.remove('scrolled');
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        const messagesContainer = document.getElementById('messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const resetButton = document.getElementById('reset-button');
        
        let isThinking = false;
        let sessionId = null;
        
        // Function to add a message to the chat
        function addMessage(content, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (isUser) {
                contentDiv.textContent = content;
            } else {
                // Use marked.js to render markdown
                contentDiv.innerHTML = DOMPurify.sanitize(marked.parse(content));
                
                // Add copy buttons to code blocks
                const codeBlocks = contentDiv.querySelectorAll('pre');
                codeBlocks.forEach(block => {
                    const copyButton = document.createElement('button');
                    copyButton.className = 'copy-button';
                    copyButton.textContent = 'Copy';
                    copyButton.addEventListener('click', function() {
                        const code = block.querySelector('code').textContent;
                        navigator.clipboard.writeText(code).then(() => {
                            copyButton.textContent = 'Copied!';
                            setTimeout(() => {
                                copyButton.textContent = 'Copy';
                            }, 2000);
                        });
                    });
                    block.appendChild(copyButton);
                });
            }
            
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Function to show thinking animation
        function showThinking() {
            if (isThinking) return;
            
            isThinking = true;
            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'thinking';
            thinkingDiv.id = 'thinking-indicator';
            
            const dotsDiv = document.createElement('div');
            dotsDiv.className = 'thinking-dots';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.className = 'thinking-dot';
                dotsDiv.appendChild(dot);
            }
            
            thinkingDiv.appendChild(dotsDiv);
            messagesContainer.appendChild(thinkingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Function to hide thinking animation
        function hideThinking() {
            if (!isThinking) return;
            
            const thinkingDiv = document.getElementById('thinking-indicator');
            if (thinkingDiv) {
                thinkingDiv.remove();
            }
            isThinking = false;
        }
        
        // Function to send a message to the backend
        async function sendMessage(message) {
            try {
                showThinking();
                
                const response = await fetch('https://venice-backend-14aff752beac.herokuapp.com/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        session_id: sessionId
                    }),
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                sessionId = data.session_id;
                
                hideThinking();
                addMessage(data.response, false);
            } catch (error) {
                console.error('Error:', error);
                hideThinking();
                addMessage('Sorry, there was an error processing your request. Please try again later.', false);
            }
        }
        
        // Function to reset the conversation
        async function resetConversation() {
            try {
                const response = await fetch('https://venice-backend-14aff752beac.herokuapp.com/reset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                // Clear the messages container
                messagesContainer.innerHTML = '';
                sessionId = null;
                
                // Add a system message
                addMessage('Conversation has been reset. You can start a new chat now.', false);
            } catch (error) {
                console.error('Error:', error);
                addMessage('Sorry, there was an error resetting the conversation. Please try again later.', false);
            }
        }
        
        // Event listener for send button
        sendButton.addEventListener('click', function() {
            const message = userInput.value.trim();
            if (message) {
                addMessage(message, true);
                userInput.value = '';
                sendMessage(message);
            }
        });
        
        // Event listener for enter key
        userInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendButton.click();
            }
        });
        
        // Event listener for reset button
        resetButton.addEventListener('click', resetConversation);
        
        // Add initial message
        addMessage('Hello! I am the Portland Hacker Foundation AI assistant. How can I help you today?', false);
    });
</script>
</body>
</html>
